{% extends 'base.html' %}

{% block title %}
Página Inicial - Meu Site
{% endblock %}

{% block content %}
{% if messages %}
  <div class="messages">
    {% for message in messages %}
      <div class="message {{ message.tags }}">{{ message }}</div>
    {% endfor %}
  </div>
{% endif %}
<h1 class="title">Olá, {{ user.username }}!</h1>

<div class="card">
  <h3 class="subtitle">Nova Tarefa</h3>
  <form method="POST">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn-primary">Adicionar Tarefa</button>
  </form>
</div>

<div class="card">
 <h3 class="subtitle">Novo Projeto</h3>
  {% if user.is_authenticated %}
  <form action ="{% url 'adicionar_projeto'%}" method="get">
    <button type="submit" class="btn-primary">Adicionar Projeto</button>
      </form>
  {% else %}
      <p class="empty-message">Você precisa estar logado para adicionar projetos.</p>
  {% endif %}
</div>
</div>
  <h3 class="subtitle">Tecnologias que estou aprendendo</h3>
  {% if tecnologias %}
  <ul class="tech-list">
    {% for tecnologia in tecnologias %}
    <li class="tech-item">{{ tecnologia }}</li>
    {% endfor %}
  </ul>
  {% else %}
  <p class="empty-message">Você não está aprendendo nenhuma tecnologia no momento.</p>
  {% endif %}
</div>


<div class="card">
  <h2 class="subtitle">Minha Lista de Tarefas</h2>

  {% if tarefas %}
  {% for tarefa in tarefas %}
  <div class="task-card">

    <p class="task-project">Projeto: <strong>{{ tarefa.project.titulo }}</strong></p>

    <p class="task-title">
  <strong>{{ tarefa.titulo }}</strong>
</p>

{% if tarefa.descricao %}
<p class="task-desc">
  {{ tarefa.descricao }}
</p>
{% endif %}

<p class="task-info">
  Prioridade: <strong>{{ tarefa.get_prioridade_display }}</strong><br>
  Prazo: <strong>{{ tarefa.prazo|date:"d/m/Y" }}</strong>
</p>

<p class="task-status">
  {% if tarefa.concluida %}
    <span class="status-concluida">
      ✔ Concluída em {{ tarefa.data_conclusao|date:"d/m/Y H:i" }}
    </span>
  {% else %}
    <span class="status-pendente">☐ Pendente</span>
  {% endif %}
</p>

<small class="task-date">
  Criada em: {{ tarefa.criada_em|date:'d/m/Y H:i' }}
</small>

    <div style="margin-top: 10px;">

  <form action="{% url 'deletar_tarefa' tarefa.pk %}" method="POST" style="display: inline;">
    {% csrf_token %}
    <button type="submit" class="btn btn-delete">Deletar</button>
  </form>

  <form action="{% url 'duplicar_tarefa' tarefa.pk %}" method="POST" style="display: inline;">
    {% csrf_token %}
    <button type="submit" class="btn btn-duplicar">Duplicar</button>
  </form>

  {% if not tarefa.concluida %}
  <form action="{% url 'concluir_tarefa' tarefa.pk %}" method="POST" style="display: inline;">
    {% csrf_token %}
    <button type="submit" class="btn btn-concluir">Marcar como Concluída</button>
  </form>
  {% endif %}

  {% if tarefa.concluida %}
  <form action="{% url 'concluir_tarefa' tarefa.pk %}" method="POST" style="display: inline;">
    {% csrf_token %}
    <button type="submit" class="btn btn-pendente">Marcar como Pendente</button>
  </form>
  {% endif %}

</div>

    </div>

  </div>
  {% endfor %}
  {% else %}
  <p class="empty-message">Você ainda não tem tarefas cadastradas.</p>
  {% endif %}
</div>

{% endblock %}